# 自動保存機能の活用

Markdown Lite の自動保存機能は、作業中のデータ損失を防ぐ重要な機能です。効果的な設定と使い方を解説します。

## 自動保存の基本

### 自動保存の仕組み
```markdown
動作原理:
1. テキストに変更が加わると内部で変更フラグが立つ
2. 指定した時間（デフォルト1秒）無操作状態が続く
3. 自動的にファイルがディスクに保存される
4. ファイル名横の保存インジケータが更新される
```

### 保存状態の確認
- **●** マーク: 未保存の変更あり
- **マークなし**: すべて保存済み
- **灰色●**: 保存中（一時的に表示）

### デフォルト設定
```json
{
  "autoSave": {
    "enabled": true,
    "delay": 1000,
    "showNotification": false,
    "backupInterval": 300
  }
}
```

## 設定のカスタマイズ

### 基本設定の変更
1. **メニュー操作**: Markdown Lite → 環境設定 → エディター
2. **自動保存設定**:
   - 有効/無効の切り替え
   - 保存間隔の調整
   - 通知設定

### 推奨設定値

**通常の文書作成**
```markdown
保存間隔: 1-2秒
理由: タイピングの邪魔にならず、データ損失リスクを最小化
```

**大きなファイル（1MB以上）**
```markdown
保存間隔: 5-10秒
理由: 頻繁な保存によるパフォーマンス低下を防止
```

**共有フォルダでの作業**
```markdown
保存間隔: 3-5秒
理由: 他のユーザーとの競合を防ぎ、同期負荷を軽減
```

## 高度な自動保存機能

### バックアップ保存
```markdown
機能:
- メインファイルとは別にバックアップコピーを作成
- 指定間隔（デフォルト5分）で自動実行
- 最大10世代まで履歴を保持

保存場所:
~/Library/Application Support/Markdown Lite/backups/
├── document.md.backup.1
├── document.md.backup.2
└── document.md.backup.3
```

### 一時保存（セッション保存）
```markdown
機能:
- アプリ終了時に開いていたファイルの状態を保存
- 未保存の変更内容も一時的に保護
- 次回起動時に前回の状態を復元

保存内容:
- 開いていたファイル一覧
- カーソル位置
- スクロール位置
- 未保存の変更内容
```

### 競合解決機能
```markdown
シナリオ: 複数の場所で同じファイルが編集された場合

自動処理:
1. ファイルの変更検出
2. ユーザーに競合通知を表示
3. 解決オプションの提供:
   - 現在の内容で上書き
   - ディスクの内容で置換
   - マージエディタで手動解決
```

## トラブルシューティング

### 自動保存が動作しない

**原因1: 権限不足**
```bash
# ファイル権限の確認
ls -la filename.md

# 権限の修正
chmod 644 filename.md
```

**原因2: ディスク容量不足**
```markdown
確認方法:
1. Apple メニュー → このマックについて → ストレージ
2. 利用可能スペースを確認
3. 1GB以上の空きを推奨

対策:
- 不要ファイルの削除
- ゴミ箱の空にする
- 大きなファイルの移動
```

**原因3: クラウド同期の問題**
```markdown
症状: クラウドフォルダで保存が失敗

対策:
1. インターネット接続の確認
2. クラウドサービスの同期状態確認
3. 一時的にローカルフォルダに保存
4. 同期完了後にクラウドフォルダに移動
```

### 保存頻度の最適化

**パフォーマンス重視設定**
```json
{
  "autoSave": {
    "delay": 3000,
    "throttle": true,
    "skipLargeFiles": true,
    "maxFileSize": "10MB"
  }
}
```

**データ保護重視設定**
```json
{
  "autoSave": {
    "delay": 500,
    "backupEnabled": true,
    "backupInterval": 60,
    "maxBackups": 20
  }
}
```

## バックアップ戦略

### 3-2-1ルールの実装
```markdown
3つのコピー:
1. 作業中のオリジナルファイル
2. 自動バックアップ（ローカル）
3. クラウド同期コピー

2つの異なるメディア:
1. 内蔵SSD（高速アクセス）
2. クラウドストレージ（冗長性）

1つのオフサイト保存:
- クラウドストレージ
- 外付けドライブ（定期的に更新）
```

### バックアップファイルの管理

**手動バックアップ作成**
```bash
# 日付付きバックアップの作成
cp document.md "document_$(date +%Y%m%d_%H%M).md"

# フォルダ全体のバックアップ
tar -czf "markdown_backup_$(date +%Y%m%d).tar.gz" ~/Documents/Markdown/
```

**古いバックアップの整理**
```bash
# 30日以上古いバックアップを削除
find ~/Library/Application\ Support/Markdown\ Lite/backups/ -name "*.backup.*" -mtime +30 -delete

# バックアップサイズの確認
du -sh ~/Library/Application\ Support/Markdown\ Lite/backups/
```

## 協働作業での自動保存

### チーム環境での設定
```markdown
推奨設定:
- 保存間隔: 3-5秒（競合回避）
- バックアップ有効化
- 競合通知の有効化
- ファイルロック機能の使用
```

### 同期競合の予防
```markdown
ベストプラクティス:
1. 作業前に最新版の取得
2. 編集開始をチームに通知
3. 短時間での作業完了
4. 作業完了をチームに通知
5. 定期的な手動保存
```

### 競合発生時の対処
```markdown
手順:
1. 競合通知の確認
2. 競合内容の分析
3. マージ戦略の決定
4. 手動マージまたは自動マージ選択
5. 結果の確認と検証
```

## 自動保存の監視と分析

### 保存統計の確認
```markdown
情報表示:
- ファイル → 文書情報 → 保存統計
- 最終保存時刻
- 自動保存回数
- バックアップ作成数
- ファイルサイズの変遷
```

### パフォーマンス影響の測定
```bash
# 保存時間の測定
time cp large_document.md large_document_copy.md

# I/O使用量の監視
sudo iotop -P $(pgrep "Markdown Lite")
```

## 緊急時の復旧手順

### 未保存データの復旧
```markdown
Step 1: 自動保存ファイルの確認
~/Library/Application Support/Markdown Lite/autosave/

Step 2: 一時ファイルの検索
/tmp/markdown-lite-session-*

Step 3: バックアップからの復元
~/Library/Application Support/Markdown Lite/backups/

Step 4: クラウドバージョンの確認
クラウドサービスのバージョン履歴機能
```

### データ整合性の検証
```bash
# ファイルサイズの比較
ls -la document.md*

# ハッシュ値による整合性確認
shasum -a 256 document.md document.md.backup.1

# テキスト差分の確認
diff document.md document.md.backup.1
```

## 自動保存の無効化が必要な場面

### 特殊な作業環境
```markdown
無効化を検討する場面:
1. 極めて大きなファイル（100MB+）
2. ネットワークドライブでの作業
3. 古いMacでのパフォーマンス問題
4. バッテリー駆動時の省電力モード
5. プレゼンテーション中の動作安定化
```

### 手動保存への切り替え
```markdown
手動保存のメリット:
- 保存タイミングの完全制御
- パフォーマンスへの影響なし
- 意図しない中間状態の保存を防止

注意点:
- 保存忘れによるデータ損失リスク
- 定期的な手動保存の習慣が必要
- 停電やクラッシュ時の被害拡大
```

---

**関連記事**
- [ファイル管理機能](file-management.md)
- [データバックアップ戦略](../advanced-usage/backup-strategies.md)
- [よくある問題と解決方法](../troubleshooting/common-issues.md)